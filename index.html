<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹åŠ¿æ§åˆ¶å¹»ç¯ç‰‡ç³»ç»Ÿ - æŒç»­ç¿»é¡µåŠŸèƒ½</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            overflow-x: hidden;
        }

        header {
            text-align: center;
            padding: 20px 0;
            width: 100%;
            max-width: 1000px;
            margin: 0 auto 30px;
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            background: linear-gradient(to right, #ff7e5f, #feb47b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            margin-top: 10px;
            color: #e0e0e0;
        }

        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            width: 100%;
            max-width: 1200px;
        }

        .slideshow-container {
            flex: 1;
            min-width: 500px;
            background: rgba(25, 25, 35, 0.85);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            padding: 25px;
            position: relative;
            overflow: hidden;
        }

        .slideshow {
            position: relative;
            height: 500px;
            overflow: hidden;
            border-radius: 15px;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.6);
            background: #121212;
        }

        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.6s ease;
            background: linear-gradient(145deg, #1e1e2f, #252540);
            text-align: center;
        }

        .slide.active {
            opacity: 1;
            transform: translateX(0);
            z-index: 2;
        }

        .slide h2 {
            font-size: 2.5rem;
            margin-bottom: 25px;
            color: #ff7e5f;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
        }

        .slide-content {
            font-size: 1.4rem;
            line-height: 1.8;
            color: #e0e0e0;
            max-width: 90%;
        }

        .slide-content p {
            margin-bottom: 15px;
        }

        .camera-container {
            flex: 1;
            min-width: 400px;
            background: rgba(25, 25, 35, 0.85);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            padding: 25px;
            display: flex;
            flex-direction: column;
        }

        .camera-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .camera-header h2 {
            font-size: 1.8rem;
            color: #4facfe;
            margin-bottom: 10px;
        }

        .camera-view {
            position: relative;
            width: 100%;
            height: 350px;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .camera-view video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #cameraPlaceholder {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
        }

        .gesture-output {
            background: rgba(20, 20, 30, 0.9);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            font-size: 1.3rem;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.4);
            border: 1px solid #4facfe;
        }

        .gesture-name {
            font-size: 1.8rem;
            font-weight: bold;
            color: #feb47b;
            margin-bottom: 10px;
        }

        .gesture-desc {
            color: #a0a0c0;
            font-size: 1.1rem;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .control-btn {
            background: linear-gradient(to right, #4facfe, #00f2fe);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 14px 25px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .control-btn:active {
            transform: translateY(1px);
        }

        .slide-indicators {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 25px 0;
        }

        .indicator {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #4facfe;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.5;
        }

        .indicator.active {
            opacity: 1;
            transform: scale(1.3);
            background: #ff7e5f;
            box-shadow: 0 0 10px rgba(255, 126, 95, 0.7);
        }

        .slide-counter {
            text-align: center;
            font-size: 1.2rem;
            color: #a0a0c0;
            margin-bottom: 15px;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .nav-btn {
            background: rgba(79, 172, 254, 0.2);
            color: #4facfe;
            border: 2px solid #4facfe;
            border-radius: 50px;
            padding: 12px 20px;
            font-size: 1.2rem;
            line-height: 1.2rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .gesture-effect {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10rem;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            animation: gestureEffect 1.2s ease-out forwards;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.7);
        }

        @keyframes gestureEffect {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }

            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1.5);
            }
        }

        .instructions {
            background: rgba(25, 25, 35, 0.85);
            border-radius: 20px;
            padding: 25px;
            margin-top: 30px;
            width: 100%;
            max-width: 1000px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        }

        .instructions h2 {
            text-align: center;
            margin-bottom: 25px;
            color: #00f2fe;
            font-size: 2rem;
        }

        .gesture-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .gesture-card {
            background: rgba(30, 30, 45, 0.7);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid #4facfe;
        }

        .gesture-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            background: rgba(40, 40, 60, 0.9);
        }

        .gesture-symbol {
            font-size: 4rem;
            margin-bottom: 15px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .gesture-card h3 {
            font-size: 1.4rem;
            color: #ff7e5f;
            margin-bottom: 10px;
        }

        .gesture-card p {
            color: #b0b0d0;
            font-size: 1.1rem;
        }

        .continuous-indicator {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 126, 95, 1);
            color: white;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .continuous-indicator.active {
            opacity: 1;
        }

        .continuous-indicator .material-icons {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
            }
        }

        footer {
            text-align: center;
            padding: 30px 0 20px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 1rem;
            width: 100%;
            margin-top: 30px;
        }

        @media (max-width: 900px) {
            .container {
                flex-direction: column;
                align-items: center;
            }

            .slideshow-container,
            .camera-container {
                min-width: 90%;
            }

            .slide {
                padding: 25px;
            }

            .slide h2 {
                font-size: 2rem;
            }

            .slide-content {
                font-size: 1.2rem;
            }

            .continuous-indicator {
                bottom: 15px;
                font-size: 1rem;
                padding: 10px 20px;
            }
        }

        @media (max-width: 600px) {
            .slide h2 {
                font-size: 1.8rem;
            }

            .slide-content {
                font-size: 1.1rem;
            }

            .camera-view {
                height: 300px;
            }

            .gesture-symbol {
                font-size: 3rem;
                height: 60px;
            }

            .gesture-card h3 {
                font-size: 1.2rem;
            }
        }
    </style>
</head>

<body>
    <header>
        <h1>æ‰‹åŠ¿æ§åˆ¶å¹»ç¯ç‰‡ç³»ç»Ÿ</h1>
        <p class="subtitle">æŒç»­æ‰‹åŠ¿ç¿»é¡µåŠŸèƒ½ - ä¿æŒæ‰‹åŠ¿è‡ªåŠ¨è¿ç»­ç¿»é¡µ</p>
    </header>

    <div class="continuous-indicator" id="continuousIndicator">
        <i class="material-icons">autorenew</i>
        <span>æŒç»­ç¿»é¡µä¸­...</span>
    </div>

    <div class="container">
        <div class="slideshow-container">
            <div class="slide-counter">
                å¹»ç¯ç‰‡ <span id="currentSlide">1</span> / <span id="totalSlides">5</span>
            </div>

            <div class="slideshow">
                <div class="slide active">
                    <h2>æŒç»­æ‰‹åŠ¿ç¿»é¡µåŠŸèƒ½</h2>
                    <div class="slide-content">
                        <p>ç°åœ¨æ”¯æŒæŒç»­æ‰‹åŠ¿ç¿»é¡µåŠŸèƒ½ï¼</p>
                        <p>ä¿æŒğŸ‘æˆ–ğŸ‘æ‰‹åŠ¿ï¼Œå¹»ç¯ç‰‡ä¼šè‡ªåŠ¨è¿ç»­ç¿»é¡µã€‚</p>
                        <p>å°è¯•ä¿æŒç‚¹èµæ‰‹åŠ¿è¶…è¿‡2ç§’é’Ÿï¼Œçœ‹çœ‹æ•ˆæœã€‚</p>
                    </div>
                </div>

                <div class="slide">
                    <h2>æ‰‹åŠ¿è¯†åˆ«æŠ€æœ¯</h2>
                    <div class="slide-content">
                        <p>æœ¬ç³»ç»Ÿä½¿ç”¨å…ˆè¿›çš„æ‰‹åŠ¿è¯†åˆ«æŠ€æœ¯ï¼Œèƒ½å¤Ÿå®æ—¶è¯†åˆ«å¤šç§æ‰‹åŠ¿åŠ¨ä½œã€‚</p>
                        <p>é€šè¿‡æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œç³»ç»Ÿå¯ä»¥å‡†ç¡®è¯†åˆ«æ‚¨çš„æ„å›¾ï¼Œè®©æ‚¨æ— éœ€ä»»ä½•è®¾å¤‡å³å¯æ§åˆ¶æ¼”ç¤ºã€‚</p>
                    </div>
                </div>

                <div class="slide">
                    <h2>æ‰‹åŠ¿æ§åˆ¶æŒ‡å—</h2>
                    <div class="slide-content">
                        <p>ğŸ‘ ç‚¹èµæ‰‹åŠ¿ï¼šå‰è¿›åˆ°ä¸‹ä¸€é¡µ</p>
                        <p>ğŸ‘ ç‚¹è¸©æ‰‹åŠ¿ï¼šè¿”å›ä¸Šä¸€é¡µ</p>
                        <p>â˜ï¸ é£ŸæŒ‡å‘ä¸‹ï¼šè·³è½¬åˆ°ç¬¬ä¸€é¡µ</p>
                        <p>ğŸ¤Ÿ æˆ‘çˆ±ä½ æ‰‹åŠ¿ï¼šè·³è½¬åˆ°æœ€åä¸€é¡µ</p>
                        <p>ä¿æŒæ‰‹åŠ¿ï¼šè‡ªåŠ¨è¿ç»­ç¿»é¡µ</p>
                    </div>
                </div>

                <div class="slide">
                    <h2>åº”ç”¨åœºæ™¯</h2>
                    <div class="slide-content">
                        <p>ä¼šè®®æ¼”ç¤ºï¼šæ— éœ€é¥æ§å™¨ï¼Œè‡ªç”±èµ°åŠ¨è¿›è¡Œæ¼”è®²</p>
                        <p>æ•™å­¦åœºæ™¯ï¼šæ•™å¸ˆå¯ä»¥æ›´ä¸“æ³¨äºæ•™å­¦å†…å®¹</p>
                        <p>äº§å“å±•ç¤ºï¼šä¸ºè§‚ä¼—å¸¦æ¥æ²‰æµ¸å¼ä½“éªŒ</p>
                        <p>æ— éšœç¢è®¾è®¡ï¼šä¸ºè¡ŒåŠ¨ä¸ä¾¿è€…æä¾›ä¾¿æ·æ§åˆ¶æ–¹å¼</p>
                    </div>
                </div>

                <div class="slide">
                    <h2>å¼€å§‹æ‚¨çš„æ¼”ç¤º</h2>
                    <div class="slide-content">
                        <p>ç°åœ¨æ‚¨å·²ç»äº†è§£äº†æ‰€æœ‰åŠŸèƒ½ï¼Œè¯·å¼€å§‹æ‚¨çš„ç²¾å½©æ¼”ç¤ºï¼</p>
                        <p>ä½¿ç”¨æ‰‹åŠ¿è‡ªç”±æ§åˆ¶å¹»ç¯ç‰‡ï¼Œäº«å—ç§‘æŠ€å¸¦æ¥çš„ä¾¿æ·ä½“éªŒã€‚</p>
                        <p>ç¥æ‚¨æ¼”ç¤ºæˆåŠŸï¼</p>
                    </div>
                </div>
            </div>

            <div class="slide-indicators">
                <div class="indicator active" data-slide="0"></div>
                <div class="indicator" data-slide="1"></div>
                <div class="indicator" data-slide="2"></div>
                <div class="indicator" data-slide="3"></div>
                <div class="indicator" data-slide="4"></div>
            </div>

            <div class="nav-buttons">
                <button id="prevButton" class="nav-btn">
                    <i class="material-icons">navigate_before</i>
                    <span>ä¸Šä¸€é¡µ</span>
                </button>
                <button id="nextButton" class="nav-btn">
                    <span>ä¸‹ä¸€é¡µ</span>
                    <i class="material-icons">navigate_next</i>
                </button>
            </div>
        </div>

        <div class="camera-container">
            <div class="camera-header">
                <h2>æ‰‹åŠ¿è¯†åˆ«æ§åˆ¶å°</h2>
                <p>å¯ç”¨æ‘„åƒå¤´å¼€å§‹æ‰‹åŠ¿æ§åˆ¶</p>
            </div>

            <div class="camera-view">
                <video id="webcam" autoplay playsinline></video>
                <div id="cameraPlaceholder">
                    <i class="material-icons" style="font-size: 4rem; color: #4facfe;">videocam_off</i>
                    <p style="margin-top: 15px; color: #a0a0c0;">æ‘„åƒå¤´æœªå¯ç”¨</p>
                </div>
            </div>

            <div id="gesture_output" class="gesture-output">
                <div class="gesture-name">ç­‰å¾…æ‰‹åŠ¿è¯†åˆ«</div>
                <div class="gesture-desc">è¯·å¯ç”¨æ‘„åƒå¤´å¹¶åšå‡ºæ‰‹åŠ¿</div>
            </div>

            <div class="controls">
                <button id="webcamButton" class="control-btn">
                    <i class="material-icons">videocam</i> å¯ç”¨æ‘„åƒå¤´
                </button>
            </div>
        </div>
    </div>

    <div class="instructions">
        <h2>æ‰‹åŠ¿æ§åˆ¶è¯´æ˜</h2>
        <div class="gesture-grid">
            <div class="gesture-card">
                <div class="gesture-symbol">ğŸ‘</div>
                <h3>ç‚¹èµæ‰‹åŠ¿</h3>
                <p>å‰è¿›åˆ°ä¸‹ä¸€é¡µå¹»ç¯ç‰‡</p>
                <p><small>ä¿æŒæ‰‹åŠ¿è‡ªåŠ¨è¿ç»­ç¿»é¡µ</small></p>
            </div>

            <div class="gesture-card">
                <div class="gesture-symbol">ğŸ‘</div>
                <h3>ç‚¹è¸©æ‰‹åŠ¿</h3>
                <p>è¿”å›ä¸Šä¸€é¡µå¹»ç¯ç‰‡</p>
                <p><small>ä¿æŒæ‰‹åŠ¿è‡ªåŠ¨è¿ç»­ç¿»é¡µ</small></p>
            </div>

            <div class="gesture-card">
                <div class="gesture-symbol">â˜ï¸</div>
                <h3>é£ŸæŒ‡å‘ä¸‹</h3>
                <p>è·³è½¬åˆ°ç¬¬ä¸€é¡µå¹»ç¯ç‰‡</p>
            </div>

            <div class="gesture-card">
                <div class="gesture-symbol">ğŸ¤Ÿ</div>
                <h3>æˆ‘çˆ±ä½ æ‰‹åŠ¿</h3>
                <p>è·³è½¬åˆ°æœ€åä¸€é¡µå¹»ç¯ç‰‡</p>
            </div>
        </div>
    </div>

    <footer>
        <p>æ‰‹åŠ¿æ§åˆ¶å¹»ç¯ç‰‡ç³»ç»Ÿ | æŒç»­æ‰‹åŠ¿ç¿»é¡µåŠŸèƒ½ | åŸºäºMediaPipeæ‰‹åŠ¿è¯†åˆ«æŠ€æœ¯</p>
    </footer>

    <script type="module">
        // å¼•å…¥MediaPipeæ‰‹åŠ¿è¯†åˆ«åº“
        import {
            GestureRecognizer,
            FilesetResolver
        } from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest";

        // DOMå…ƒç´ å¼•ç”¨
        const gestureOutput = document.getElementById("gesture_output");
        const webcamButton = document.getElementById("webcamButton");
        const slides = document.querySelectorAll('.slide');
        const indicators = document.querySelectorAll('.indicator');
        const currentSlideElement = document.getElementById("currentSlide");
        const totalSlidesElement = document.getElementById("totalSlides");
        const videoElement = document.getElementById("webcam");
        const cameraPlaceholder = document.getElementById("cameraPlaceholder");
        const prevButton = document.getElementById("prevButton");
        const nextButton = document.getElementById("nextButton");
        const continuousIndicator = document.getElementById("continuousIndicator");

        // å…¨å±€å˜é‡
        let gestureRecognizer;
        let webcamRunning = false;
        let lastGesture = "";
        let currentSlide = 0;
        let lastDetectionTime = 0;
        let continuousMode = null;
        let gestureHoldStart = 0;
        let continuousInterval = null;

        // åˆå§‹åŒ–å¹»ç¯ç‰‡
        totalSlidesElement.textContent = slides.length;

        // åˆ›å»ºæ‰‹åŠ¿è¯†åˆ«å™¨
        async function createGestureRecognizer() {
            try {
                const vision = await FilesetResolver.forVisionTasks(
                    "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"
                );

                gestureRecognizer = await GestureRecognizer.createFromOptions(vision, {
                    baseOptions: {
                        modelAssetPath: "https://storage.googleapis.com/mediapipe-models/gesture_recognizer/gesture_recognizer/float16/1/gesture_recognizer.task",
                        delegate: "GPU"
                    },
                    runningMode: "VIDEO",
                    numHands: 1
                });

                console.log("æ‰‹åŠ¿è¯†åˆ«å™¨å·²åŠ è½½");
                gestureOutput.innerHTML = `
                    <div class="gesture-name">è¯†åˆ«å™¨å·²å°±ç»ª</div>
                    <div class="gesture-desc">è¯·å¯ç”¨æ‘„åƒå¤´å¼€å§‹æ‰‹åŠ¿æ§åˆ¶</div>
                `;
                webcamButton.disabled = false;
            } catch (error) {
                console.error("æ‰‹åŠ¿è¯†åˆ«å™¨åˆ›å»ºå¤±è´¥:", error);
                gestureOutput.innerHTML = `
                    <div class="gesture-name">è¯†åˆ«å™¨åŠ è½½å¤±è´¥</div>
                    <div class="gesture-desc">è¯·åˆ·æ–°é¡µé¢é‡è¯•</div>
                `;
            }
        }

        // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒæ‘„åƒå¤´
        function hasGetUserMedia() {
            return !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);
        }

        // æ·»åŠ æ‘„åƒå¤´å¯ç”¨æŒ‰é’®äº‹ä»¶
        if (hasGetUserMedia()) {
            webcamButton.addEventListener('click', toggleWebcam);
        } else {
            console.warn("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ‘„åƒå¤´è®¿é—®");
            webcamButton.disabled = true;
            webcamButton.innerHTML = '<i class="material-icons">warning</i> æµè§ˆå™¨ä¸æ”¯æŒæ‘„åƒå¤´';
        }

        // æ·»åŠ å¹»ç¯ç‰‡å¯¼èˆªäº‹ä»¶
        prevButton.addEventListener('click', () => goToSlide(currentSlide - 1));
        nextButton.addEventListener('click', () => goToSlide(currentSlide + 1));

        // æ·»åŠ æŒ‡ç¤ºå™¨ç‚¹å‡»äº‹ä»¶
        indicators.forEach(indicator => {
            indicator.addEventListener('click', () => {
                const slideIndex = parseInt(indicator.dataset.slide);
                goToSlide(slideIndex);
            });
        });

        // åˆ‡æ¢æ‘„åƒå¤´çŠ¶æ€
        async function toggleWebcam() {
            if (!gestureRecognizer) {
                alert("æ‰‹åŠ¿è¯†åˆ«å™¨å°šæœªåŠ è½½å®Œæˆï¼Œè¯·ç¨å€™");
                return;
            }

            if (webcamRunning) {
                // å…³é—­æ‘„åƒå¤´
                stopWebcam();
                webcamButton.innerHTML = '<i class="material-icons">videocam</i> å¯ç”¨æ‘„åƒå¤´';
                stopContinuousMode(); // ç¡®ä¿åœæ­¢è¿ç»­æ¨¡å¼
            } else {
                // å¯ç”¨æ‘„åƒå¤´
                try {
                    webcamButton.innerHTML = '<i class="material-icons">hourglass_top</i> æ­£åœ¨å¯åŠ¨...';
                    await startWebcam();
                    webcamButton.innerHTML = '<i class="material-icons">videocam_off</i> å…³é—­æ‘„åƒå¤´';
                } catch (error) {
                    console.error("æ‘„åƒå¤´å¯ç”¨å¤±è´¥:", error);
                    webcamButton.innerHTML = '<i class="material-icons">videocam</i> å¯ç”¨æ‘„åƒå¤´';
                }
            }
        }

        // å¯åŠ¨æ‘„åƒå¤´
        async function startWebcam() {
            try {
                // è¯·æ±‚æ‘„åƒå¤´è®¿é—®æƒé™
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'user',
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        frameRate: { ideal: 30 }
                    }
                });

                videoElement.srcObject = stream;
                cameraPlaceholder.style.display = "none";

                // ç­‰å¾…è§†é¢‘æ•°æ®åŠ è½½
                await new Promise((resolve) => {
                    videoElement.onloadeddata = resolve;
                });

                // å¼€å§‹é¢„æµ‹
                webcamRunning = true;
                lastDetectionTime = performance.now();
                predictWebcam();
            } catch (err) {
                console.error("æ‘„åƒå¤´è®¿é—®é”™è¯¯:", err);
                if (err.name === 'NotAllowedError') {
                    alert("æ‘„åƒå¤´è®¿é—®è¢«æ‹’ç»ã€‚è¯·æ£€æŸ¥æµè§ˆå™¨æƒé™è®¾ç½®å¹¶å…è®¸è®¿é—®æ‘„åƒå¤´ã€‚");
                } else {
                    alert(`æ— æ³•è®¿é—®æ‘„åƒå¤´: ${err.message}`);
                }
                throw err;
            }
        }

        // åœæ­¢æ‘„åƒå¤´
        function stopWebcam() {
            webcamRunning = false;
            if (videoElement.srcObject) {
                const tracks = videoElement.srcObject.getTracks();
                tracks.forEach(track => track.stop());
                videoElement.srcObject = null;
            }
            cameraPlaceholder.style.display = "flex";
            gestureOutput.innerHTML = `
                <div class="gesture-name">æ‘„åƒå¤´å·²å…³é—­</div>
                <div class="gesture-desc">ç‚¹å‡»æŒ‰é’®é‡æ–°å¯ç”¨</div>
            `;
            stopContinuousMode(); // ç¡®ä¿åœæ­¢è¿ç»­æ¨¡å¼
        }

        // åœæ­¢è¿ç»­ç¿»é¡µæ¨¡å¼
        function stopContinuousMode() {
            if (continuousInterval) {
                clearInterval(continuousInterval);
                continuousInterval = null;
            }
            continuousIndicator.classList.remove('active');
            continuousMode = null;
        }

        // å¼€å§‹è¿ç»­ç¿»é¡µæ¨¡å¼
        function startContinuousMode(direction) {
            if (continuousMode === direction) return;

            stopContinuousMode(); // å…ˆåœæ­¢ä»»ä½•ç°æœ‰çš„è¿ç»­æ¨¡å¼

            continuousMode = direction;
            continuousIndicator.classList.add('active');

            // ç«‹å³æ‰§è¡Œä¸€æ¬¡ç¿»é¡µ
            if (direction === 'next') {
                goToSlide(currentSlide + 1);
            } else {
                goToSlide(currentSlide - 1);
            }

            // è®¾ç½®è¿ç»­ç¿»é¡µçš„é—´éš”
            continuousInterval = setInterval(() => {
                if (direction === 'next') {
                    goToSlide(currentSlide + 1);
                } else {
                    goToSlide(currentSlide - 1);
                }
            }, 1500); // æ¯1500æ¯«ç§’ç¿»é¡µä¸€æ¬¡
        }

        // é¢„æµ‹æ‘„åƒå¤´ç”»é¢
        async function predictWebcam() {
            if (!webcamRunning) return;

            // é™åˆ¶æ£€æµ‹é¢‘ç‡ï¼ˆæ¯400msæ£€æµ‹ä¸€æ¬¡ï¼‰
            const now = performance.now();
            if (now - lastDetectionTime < 400) {
                requestAnimationFrame(predictWebcam);
                return;
            }
            lastDetectionTime = now;

            // å¼€å§‹æ£€æµ‹
            try {
                // æ£€æµ‹æ‰‹åŠ¿
                const results = await gestureRecognizer.recognizeForVideo(videoElement, Date.now());

                // æ˜¾ç¤ºæ‰‹åŠ¿è¯†åˆ«ç»“æœå¹¶å¤„ç†äº¤äº’
                if (results.gestures.length > 0) {
                    const categoryName = results.gestures[0][0].categoryName;
                    const categoryScore = parseFloat(results.gestures[0][0].score * 100).toFixed(2);

                    gestureOutput.innerHTML = `
                        <div class="gesture-name">${categoryName}</div>
                        <div class="gesture-desc">ç½®ä¿¡åº¦: ${categoryScore}%</div>
                    `;

                    // å¤„ç†æ‰‹åŠ¿äº¤äº’
                    if (lastGesture !== categoryName) {
                        handleGestureInteraction(categoryName);
                        lastGesture = categoryName;
                        gestureHoldStart = now; // è®°å½•æ‰‹åŠ¿å¼€å§‹æ—¶é—´
                    } else {
                        // å¦‚æœæ‰‹åŠ¿ä¿æŒè¶…è¿‡2ç§’ï¼Œåˆ™å¯åŠ¨è¿ç»­æ¨¡å¼
                        if (now - gestureHoldStart > 2000) {
                            if (categoryName === "Thumb_Up") {
                                startContinuousMode('next');
                            } else if (categoryName === "Thumb_Down") {
                                startContinuousMode('prev');
                            }
                        }
                    }
                } else {
                    gestureOutput.innerHTML = `
                        <div class="gesture-name">æœªæ£€æµ‹åˆ°æ‰‹åŠ¿</div>
                        <div class="gesture-desc">è¯·å°†æ‰‹æ”¾åœ¨æ‘„åƒå¤´å‰</div>
                    `;
                    lastGesture = "";
                    stopContinuousMode(); // åœæ­¢è¿ç»­æ¨¡å¼
                }
            } catch (error) {
                console.error("æ‰‹åŠ¿è¯†åˆ«é”™è¯¯:", error);
                gestureOutput.innerHTML = `
                    <div class="gesture-name">è¯†åˆ«å‡ºé”™</div>
                    <div class="gesture-desc">è¯·é‡è¯•</div>
                `;
                stopContinuousMode(); // åœæ­¢è¿ç»­æ¨¡å¼
            }

            // ç»§ç»­å¤„ç†
            requestAnimationFrame(predictWebcam);
        }

        // å¤„ç†æ‰‹åŠ¿äº¤äº’
        function handleGestureInteraction(gesture) {
            // åœæ­¢ä¹‹å‰çš„è¿ç»­æ¨¡å¼
            stopContinuousMode();

            switch (gesture) {
                case "Thumb_Up": // ç‚¹èµæ‰‹åŠ¿ - ä¸‹ä¸€é¡µ
                    goToSlide(currentSlide + 1);
                    showGestureEffect('ğŸ‘');
                    break;
                case "Thumb_Down": // ç‚¹è¸©æ‰‹åŠ¿ - ä¸Šä¸€é¡µ
                    goToSlide(currentSlide - 1);
                    showGestureEffect('ğŸ‘');
                    break;
                case "Pointing_Up": // é£ŸæŒ‡å‘ä¸‹ - ç¬¬ä¸€é¡µ
                    goToSlide(0);
                    showGestureEffect('â˜ï¸');
                    break;
                case "ILoveYou": // æˆ‘çˆ±ä½ æ‰‹åŠ¿ - æœ€åä¸€é¡µ
                    goToSlide(slides.length - 1);
                    showGestureEffect('ğŸ¤Ÿ');
                    break;
                default:
                    // å…¶ä»–æœªå®šä¹‰æ‰‹åŠ¿ä¸å¤„ç†
                    break;
            }
        }

        // æ˜¾ç¤ºæ‰‹åŠ¿æ•ˆæœ
        function showGestureEffect(symbol) {
            const effect = document.createElement('div');
            effect.className = 'gesture-effect';
            effect.textContent = symbol;
            document.body.appendChild(effect);

            // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
            setTimeout(() => {
                effect.remove();
            }, 1200);
        }

        // æ›´æ–°å¹»ç¯ç‰‡ä½ç½®
        function updateSlidePositions() {
            slides.forEach((slide, index) => {
                slide.classList.remove('active');

                if (index === currentSlide) {
                    slide.classList.add('active');
                }
            });

            // æ›´æ–°æŒ‡ç¤ºå™¨
            indicators.forEach((indicator, index) => {
                indicator.classList.toggle('active', index === currentSlide);
            });

            // æ›´æ–°è®¡æ•°å™¨
            currentSlideElement.textContent = currentSlide + 1;
        }

        // åˆ‡æ¢å¹»ç¯ç‰‡ï¼ˆå¾ªç¯æ¨¡å¼ï¼‰
        function goToSlide(index) {
            // å¤„ç†å¾ªç¯é€»è¾‘
            if (index < 0) {
                index = slides.length - 1;
            } else if (index >= slides.length) {
                index = 0;
            }


            // æ›´æ–°å½“å‰å¹»ç¯ç‰‡ç´¢å¼•
            currentSlide = index;

            // æ›´æ–°å¹»ç¯ç‰‡ä½ç½®å’ŒæŒ‡ç¤ºå™¨
            updateSlidePositions();

        }

        // åˆå§‹åŒ–æ‰‹åŠ¿è¯†åˆ«å™¨
        createGestureRecognizer();
    </script>
</body>

</html>